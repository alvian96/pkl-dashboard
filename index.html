// ============================
// 1. DATA MASTER REGIONAL–CABANG–JABATAN
// ============================
// Nanti mbis isi sendiri pakai data master beneran.
// Contoh struktur (silakan ganti):

const strukturData = {
  "Regional I": {
    "Merak": ["ABK", "Mualim", "Masinis"],
    "Bakauheni": ["ABK", "Nakhoda"]
  },
  "Regional II": {
    "Ketapang": ["ABK", "Staff Operasional"],
    "Gilimanuk": ["ABK", "Admin"]
  }
  // tambahkan sesuai kebutuhan...
};

// URL Web App Google Apps Script
const WEB_APP_URL = "PASTE_URL_WEB_APP_DI_SINI"; // ganti dengan URL deploy Web App

document.addEventListener("DOMContentLoaded", () => {
  const regionalSelect = document.getElementById("regional");
  const cabangSelect = document.getElementById("cabang");
  const jabatanSelect = document.getElementById("jabatan");
  const form = document.getElementById("lamaranForm");
  const statusMsg = document.getElementById("statusMsg");
  const submitBtn = document.getElementById("submitBtn");

  // ============================
  // 2. INISIALISASI DROPDOWN REGIONAL
  // ============================
  Object.keys(strukturData).forEach((regional) => {
    const opt = document.createElement("option");
    opt.value = regional;
    opt.textContent = regional;
    regionalSelect.appendChild(opt);
  });

  regionalSelect.addEventListener("change", () => {
    const selectedRegional = regionalSelect.value;

    cabangSelect.innerHTML = '<option value="">-- Pilih Cabang --</option>';
    jabatanSelect.innerHTML = '<option value="">-- Pilih Jabatan --</option>';

    if (!selectedRegional || !strukturData[selectedRegional]) return;

    Object.keys(strukturData[selectedRegional]).forEach((cabang) => {
      const opt = document.createElement("option");
      opt.value = cabang;
      opt.textContent = cabang;
      cabangSelect.appendChild(opt);
    });
  });

  cabangSelect.addEventListener("change", () => {
    const selectedRegional = regionalSelect.value;
    const selectedCabang = cabangSelect.value;

    jabatanSelect.innerHTML = '<option value="">-- Pilih Jabatan --</option>';

    if (
      !selectedRegional ||
      !selectedCabang ||
      !strukturData[selectedRegional] ||
      !strukturData[selectedRegional][selectedCabang]
    ) {
      return;
    }

    strukturData[selectedRegional][selectedCabang].forEach((jabatan) => {
      const opt = document.createElement("option");
      opt.value = jabatan;
      opt.textContent = jabatan;
      jabatanSelect.appendChild(opt);
    });
  });

  // ============================
  // 3. SUBMIT FORM
  // ============================
  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    statusMsg.textContent = "";
    statusMsg.className = "status";
    submitBtn.disabled = true;
    submitBtn.textContent = "Mengirim...";

    try {
      const fields = form.querySelectorAll("[data-column]");
      const payload = {};

      fields.forEach((field) => {
        const columnName = field.getAttribute("data-column");
        payload[columnName] = field.value.trim();
      });

      await fetch(WEB_APP_URL, {
        method: "POST",
        mode: "no-cors",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      });

      statusMsg.textContent = "Data berhasil dikirim.";
      statusMsg.classList.add("success");
      form.reset();

      cabangSelect.innerHTML = '<option value="">-- Pilih Cabang --</option>';
      jabatanSelect.innerHTML = '<option value="">-- Pilih Jabatan --</option>';
    } catch (err) {
      console.error(err);
      statusMsg.textContent = "Terjadi kesalahan saat mengirim data.";
      statusMsg.classList.add("error");
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = "Kirim Lamaran";
    }
  });
});
